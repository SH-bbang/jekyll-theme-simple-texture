---
layout: post
title: "Linux - gpt파티션 lvm만들기"
description: "Linux - gpt파티션 lvm만들기"
categories: [linux]
tags: [jekyll, linux, lvm, gpt, filesystem]
redirect_from:
  - /2020/12/16/
---

> This is code blocks and highlighting test page for [Simple Texture][Simple Texture] theme.

* Kramdown table of contents
{:toc .toc}

# ◎ GPT파티션 lvm 만들기

기존 Linux Partition 들은 MSdos label을 기본으로 사용합니다. 
이 방식 때문에 2TB 이상의 Partition을 사용할 수가 없습니다.

또, 각 드라이브당 4개의 Primary Partition(주 파티션) 밖에 사용할수 없기 때문에 Extended Partition으로 생성한 뒤 추가로 생성해야만 했습니다.

물론 OS와 Kernel 버전이 올라가면서 `fdisk` 명령으로도 gpt 파티션을 컨트롤 할수 있게 되는데 아래 내용에서 한번더 얘기하도록 하겠습니다.

이번 Post에서는`gpt( GUID Partition Table )` 를 이용하여 2TB 이상의 파티션을 컨트롤 하고 LVM 생성하는것 까지 진행 해보겠습니다.


# ◎ parted의 사용

먼저 `fdisk`명령으로 Partiton의 상태를 봅니다.

{% highlight javascript linenos=table %}
[bbang01@bbangc ~]$ sudo fdisk -l
WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.

Disk /dev/sda: 19998.4 GB, 19998441472000 bytes, 39059456000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: gpt
Disk identifier: B0CF0F54-E3BE-41D8-9606-A71C2E080E38


#         Start          End    Size  Type            Name
 1         2048       411647    200M  EFI System      EFI System Partition
 2       411648      2508799      1G  Microsoft basic
 3      2508800    384194559    182G  Linux LVM

Disk /dev/mapper/centos-root: 53.7 GB, 53687091200 bytes, 104857600 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes


Disk /dev/mapper/centos-swap: 34.4 GB, 34359738368 bytes, 67108864 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes


Disk /dev/mapper/centos-home: 107.4 GB, 107374182400 bytes, 209715200 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

[bbang01@bbangc ~]$
{% endhighlight %}

여기서 주의깊게 볼곳은 2,4,8 Line 입니다.

> Line.2  WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.
>
> 예전 OS들에서는 WARNING: GPT (GUID Partition Table) detected on '/dev/sda'! The util fdisk doesn`t support GPT. Use GNU Parted.라고 표시되면서 GPT파티션을 지원안했지만
>
> 이제는 지원은 하지만 시험단계이기 때문에 알아서 사용하라는 문구가 뜹니다. 아마 OS가 8버전 후반대 쯤에는 안정적으로 쓸수있지 않을까요?
>
> Line.4  용량이 20TB에 육박하는것을 볼수있습니다. 2TB가 넘는다면 gpt label이 되어야 컨트롤이 가능합니다.
>
> Line.8 Disk label이 gpt 기본으로 설정되어 있습니다.

저희는 현재 안정적인 방법인 `parted`명령으로 실행해 보겠습니다.

먼저 제가 수정할 Partition을 불러옵니다.

~~~~~~~~~~~~~~~~~~ ruby
[bbang01@bbangc ~]$ sudo parted /dev/sda
GNU Parted 3.1
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted)
~~~~~~~~~~~~~~~~~~

help 명령으로 사용 가능한 명령어를 확인할 수 있습니다.
그리고 `명령어 help` 조합으로 해당 명령어에서 사용 가능한 옵션 및 작성법을 확인할수 있습니다.

~~~~~~~~~~~~~~~~~~ ruby
(parted) help
  align-check TYPE N                        check partition N for TYPE(min|opt) alignment
  help [COMMAND]                           print general help, or help on COMMAND
  mklabel,mktable LABEL-TYPE               create a new disklabel (partition table)
  mkpart PART-TYPE [FS-TYPE] START END     make a partition
  name NUMBER NAME                         name partition NUMBER as NAME
  print [devices|free|list,all|NUMBER]     display the partition table, available devices, free space, all found
        partitions, or a particular partition
  quit                                     exit program
  rescue START END                         rescue a lost partition near START and END

  resizepart NUMBER END                    resize partition NUMBER
  rm NUMBER                                delete partition NUMBER
  select DEVICE                            choose the device to edit
  disk_set FLAG STATE                      change the FLAG on selected device
  disk_toggle [FLAG]                       toggle the state of FLAG on selected device
  set NUMBER FLAG STATE                    change the FLAG on partition NUMBER
  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition NUMBER
  unit UNIT                                set the default unit to UNIT
  version                                  display the version number and copyright information of GNU Parted
(parted) 
(parted) 
(parted) 
(parted) help set
  set NUMBER FLAG STATE                    change the FLAG on partition NUMBER

        NUMBER is the partition number used by Linux.  On MS-DOS disk labels, the primary partitions number from 1 to
        4, logical partitions from 5 onwards.
        FLAG is one of: boot, root, swap, hidden, raid, lvm, lba, hp-service, palo, prep, msftres, bios_grub,
        atvrecv, diag, legacy_boot
        STATE is one of: on, off
~~~~~~~~~~~~~~~~~~

이제 파티션 생성을 진행 해줍니다.

{% highlight javascript linenos=table %}
(parted) unit gb		// 설정단위를 GB로 지정
(parted)
(parted) print			// 수정중인 Partition 확인
Model: DELL PERC H730 Mini (scsi)
Disk /dev/sda: 19998GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name                  Flags
 1      0.00GB  0.21GB  0.21GB  fat16        EFI System Partition  boot
 2      0.21GB  1.28GB  1.07GB  xfs
 3      1.28GB  197GB   195GB                                      lvm


(parted) mkpart 4 197 16384	// 자세한 설명은 아래에서
(parted)
(parted) set 4 lvm on		// 4번 Partiton울lvm으로 지정
(parted)
(parted) print			// 4번 생성확인
Model: DELL PERC H730 Mini (scsi)
Disk /dev/sda: 19998GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End      Size     File system  Name                  Flags
 1      0.00GB  0.21GB   0.21GB   fat16        EFI System Partition  boot
 2      0.21GB  1.28GB   1.07GB   xfs
 3      1.28GB  197GB    195GB                                       lvm
 4      197GB   16384GB  16187GB               4                     lvm

(parted)
(parted) quit			// parted 종료
Information: You may need to update /etc/fstab.
{% endhighlight %}

위에서 봤을때 `mkpart 4 197 16384`의 각 Flag들을 자세히 살펴 보겠습니다.

> mkpart => partition 생성 명령어
>
> 4 => Partition Nunber 지정 // gpt는 extended할필요 없이 계속 추가가 가능
>
> 197 => Partition의 시작점 // 3번 Partiton의 End 지점
>
> 16384 => Partition의 끝점 // `총용량=끝점-시작점` 으로 계산

이제 다시 `fdisk`명령으로 봐도

~~~~~~~~~~~~ ruby
[bbang01@bbangc ~]$ sudo fdisk -l
WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.

Disk /dev/sda: 19998.4 GB, 19998441472000 bytes, 39059456000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: gpt
Disk identifier: B0CF0F54-E3BE-41D8-9606-A71C2E080E38


#         Start          End    Size  Type            Name
 1         2048       411647    200M  EFI System      EFI System Partition
 2       411648      2508799      1G  Microsoft basic
 3      2508800    384194559    182G  Linux LVM
 4    384194560  31999999999   14.7T  Linux LVM       4
~~~~~~~~~~~~

4번 파티션이 생성된것을 볼수있습니다.

# ◎lvm 생성


[^1]: This is a footnote.

[kramdown]: https://kramdown.gettalong.org/
[Simple Texture]: https://github.com/yizeng/jekyll-theme-simple-texture
