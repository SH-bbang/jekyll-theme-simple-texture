---
layout: post
title: "Linux - SSH 관련 보안설정- 2"
description: "Linux - SSH 관련 보안설정 - 2"
categories: [linux]
tags: [jekyll, linux, ssh, 보안설정, Port change]
redirect_from:
  - /2020/12/14/
---

> This is code blocks and highlighting test page for [Simple Texture][Simple Texture] theme.

* Kramdown table of contents
{:toc .toc}

# ◎sudo 권한 부여

`sudo` 명령이란 `Superuser do`의 명령형으로 허가받은 일반 사용자 계정에서도 `root의 superuser 권한`을 얻을수 있는 명령어입니다.

일반적으로는 일반계정 접속 -> `su -` 명령을 통한 root에 직접 접근하지만 보안상으로 상당히 취약한 방법입니다.

그래서 이번 Post에서는 `sudo 권한` 부여 방법에 대해서 알아보겠습니다.

## /etc/sudoers 

sudo 명령의 실행권한은 `/etc/sudoers` 아래에 저장되어 관리되고있습니다.

권한이 부여되지 않은 일반 계정으로 접근시 `Permission denied`라고 뜨면서 접근이 제한됩니다.

>[bbang01@localhost ~]$ cat /etc/sudoers
>cat: /etc/sudoers: Permission denied
>[bbang01@localhost ~]$

먼저 sudoers 파일 수정 방법을 알아보고 진행 해 보겠습니다.

># cat /etc/sudoers

~~~~~~~~~~~~ ruby
## Allow root to run any commands anywhere
root    ALL=(ALL)       ALL

## Allows members of the 'sys' group to run networking, software,
## service management apps and more.
# %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS

## Allows people in group wheel to run all commands
%wheel  ALL=(ALL)       ALL

## Same thing without a password
# %wheel        ALL=(ALL)       NOPASSWD: ALL

## Allows members of the users group to mount and unmount the
## cdrom as root
# %users  ALL=/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom

## Allows members of the users group to shutdown this system
# %users  localhost=/sbin/shutdown -h now
~~~~~~~~~~~~ 

이제 각 부분별로 설명을 참고 하여 원하는대로 설정을 해주시면 됩니다.

~~~~~~~~~~~~~~~~~~~~~~ ruby
root	ALL=(ALL)	ALL 

bbang01	ALL=(ALL)	ALL		// 일반 사용자만 지정하여 sudo 권한 부여

bbang02 ALL=(ALL)	NOPASSWD: ALL	// 패스워드 없이 sudo 권한 부여

%IBM	ALL=(ALL)	ALL		// 그룹에 포한된 사용자전부 sudo 권한 부여

%DELL	ALL=(ALL)	NOPASSWD: ALL	// 그룹에 포함된 사용자전부 패스워드 없이 sudo 권한 부여

~~~~~~~~~~~~~~~~~~~~~~

추가적으로 유저 또는 그룹을 골라서 특정 명령어만 사용 가능하게끔 지정도 가능합니다.

~~~~~~~~~~~~~~~~~~~~~~ ruby
bbang03	ALL=/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom	// 해당 유저는 이 명령어만 sudo 권한 부여

%HP	ALL=/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom	// 해당 그룹원은 이 명령어만 sudo 권한 부여
~~~~~~~~~~~~~~~~~~~~~~





~~~~~~~~~~~~~~~~~~~~~~ ruby
# vi /etc/ssh/sshd_config

#Port 22 //17번 라인 쯤
Port 10001 // 라인 추가 또는 22를 원하는 포트로 변경
~~~~~~~~~~~~~~~~~~~~~~

ssh_config 에서도 'Port'부분을 변경해줍니다.

sshd 재시작은 필수!

~~~ ruby
# systemctl restart sshd

or

# systemctl stop sshd; systemctl start sshd
~~~


# ◎sudo 권한 부여


`useradd` 명령어를 사용할때는 아래 처럼 간단하게 옵션을 선택해서 적용할수있습니다.

> -m : user생성시 home 디렉터리도 함께 생성 ( ex: /home/bbang01 )
>
> -g : 1차 그룹 지정  /  -G : 2차 그룹 지정
>
> -d : 임의로 home 디렉터리를 지정
>
> -s : 사용자 생성시 사용할 셀을 지정
>
> -u : UID 값을 지정하여 생성

그 뒤에는 생성한 user인 *`bbang01`*의 패스워드를 지정해 줍니다.

~~~~~~~~~~~~~~~~~~~~~~ ruby
# passwd bbang01
Changing password for user bbang01.
New password: 
Retype new password: 
passwd: all authentication tokens updated successfully.
~~~~~~~~~~~~~~~~~~~~~~

생성된 user는 `/etc/passwd` 안에 저장됩니다.

~~~~~~~~~~~~~~~~~~~~~~ ruby
# tail -n 4 /etc/passwd 
tcpdump:x:72:72::/:/sbin/nologin
git_shbang:x:1000:1000:git_shbang:/home/git_shbang:/bin/bash
sh_bbang:x:1001:1001::/home/sh_bbang:/bin/bash
bbang01:x:1002:1002::/home/bbang01:/bin/bash
~~~~~~~~~~~~~~~~~~~~~~

> 사용자이름:암호:사용자ID:그룹ID:추가정보:홈디렉토리:쉘
>
> ( 참고 - 그룹파일은 /etc/group, 비밀번호파일은 /etc/shadow )



## root 직접 접근 제한

ssh의 설정은 `/etd/ssh/` 아래에 있는 파일들의 설정으로 이루어 집니다.

그중에서도 `sshd_config` 을 통해서 설정을 진행해 보도록 하겠습니다.

~~~ ruby
# vi /etc/ssh/sshd_config
PermitRootLogin no // 보통 주석 처리 및 yes로 되어있음
~~~

PermitRootLogin 설정이 yes에서 no로 바뀔 경우 문제가 생겨서 root로만 접속해야할 경우 Console을 통해서만 가능하니 주의해야 합니다.

~~~ ruby
# systemctl restart sshd

or

# systemctl stop sshd; systemctl start sshd
~~~

재시작 한 뒤 접속이 불가능 한 것을 확인합니다.

~~~ ruby
login as: root
root@192.168.197.128's password:
Access denied
root@192.168.197.128's password:
Access denied
root@192.168.197.128's password:
~~~

~~~ ruby
login as: bbang01
bbang01@192.168.197.128's password:
Last login: Sun Dec 13 00:11:33 2020 from 192.168.197.1
[bbang01@bbang ~]$
~~~


[^1]: This is a footnote.

[kramdown]: https://kramdown.gettalong.org/
[Simple Texture]: https://github.com/yizeng/jekyll-theme-simple-texture
